<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <link rel="canonical" href="true/articles/web-security-xss/">
    
    
    <title>Web安全——XSS(跨站脚本攻击) | 独孤剑走偏锋</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#000000">
    
    
    <meta name="keywords" content="javascript,Web安全,XSS">
    <meta name="description" content="跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的XSS，需要区分情景对待。今天将学习XSS攻击的原理，已经如何正确地防御它。">
<meta name="keywords" content="javascript,Web安全,XSS">
<meta property="og:type" content="article">
<meta property="og:title" content="Web安全——XSS(跨站脚本攻击)">
<meta property="og:url" content="https://eviler.top/articles/web-security-xss/index.html">
<meta property="og:site_name" content="独孤剑走偏锋">
<meta property="og:description" content="跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的XSS，需要区分情景对待。今天将学习XSS攻击的原理，已经如何正确地防御它。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-11-07T02:18:46.111Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Web安全——XSS(跨站脚本攻击)">
<meta name="twitter:description" content="跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的XSS，需要区分情景对待。今天将学习XSS攻击的原理，已经如何正确地防御它。">
    
        <link rel="alternate" type="application/atom+xml" title="独孤剑走偏锋" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/eviler.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide"
     >
    <div class="inner flex-row-vertical">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
            <i class="icon icon-lg icon-close"></i>
        </a>
        <div class="brand-wrap" style="background-image:url(/img/headBack.jpg)">
            <div class="brand">
                <a href="/" class="avatar waves-effect waves-circle waves-light">
                    <img src="/img/eviler.png">
                </a>
                <hgroup class="introduce">
                    <h5 class="nickname">
                        Eviler Zhao
                    </h5>
                    <a href="mailto:eviler_zhao@163.com" title="eviler_zhao@163.com" class="mail">eviler_zhao@163.com</a>
                </hgroup>
            </div>
        </div>
        <div class="scroll-wrap flex-col">
            <ul class="nav">
                
                <li class="waves-block waves-effect">
                    <a href="/"  >
                        <i class="icon icon-lg icon-home"></i>
                        主页
                    </a>
                </li>
                
                <li class="waves-block waves-effect">
                    <a href="/archives"  >
                        <i class="icon icon-lg icon-archives"></i>
                        归档
                    </a>
                </li>
                
                <li class="waves-block waves-effect">
                    <a href="/tags"  >
                        <i class="icon icon-lg icon-tags"></i>
                        标签
                    </a>
                </li>
                
                <li class="waves-block waves-effect">
                    <a href="/categories"  >
                        <i class="icon icon-lg icon-th-list"></i>
                        分类
                    </a>
                </li>
                
                <li class="waves-block waves-effect">
                    <a href="https://github.com/evilerSS" target="_blank"
                         >
                        <i class="icon icon-lg icon-github"></i>
                        Github
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Web安全——XSS(跨站脚本攻击)</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Web安全——XSS(跨站脚本攻击)</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-11-06T00:52:55.000Z" itemprop="datePublished" class="page-time">
  2019-11-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web安全/">Web安全</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#XSS简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">XSS简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本概念"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">基本概念</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#XSS类型"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">XSS类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#反射型XSS"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">反射型XSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存储型XSS"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">存储型XSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DOM-Based-XSS"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">DOM Based XSS</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#XSS攻击进阶"><span class="post-toc-number">2.</span> <span class="post-toc-text">XSS攻击进阶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#初探CSS-Payload"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">初探CSS Payload</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#强大的XSS-Payload"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">强大的XSS Payload</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构造GET和POST请求"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">构造GET和POST请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#XSS钓鱼"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">XSS钓鱼</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#识别用户浏览器"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">识别用户浏览器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#识别用户安装的软件"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">识别用户安装的软件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取用户的真实IP地址"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">获取用户的真实IP地址</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#XSS攻击平台"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">XSS攻击平台</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#终极武器：XSS-Worm"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">终极武器：XSS Worm</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#调试Javascript"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">调试Javascript</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#XSS构造技巧"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">XSS构造技巧</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用字符编码"><span class="post-toc-number">2.6.1.</span> <span class="post-toc-text">利用字符编码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#绕过长度限制"><span class="post-toc-number">2.6.2.</span> <span class="post-toc-text">绕过长度限制</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-web-security-xss"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Web安全——XSS(跨站脚本攻击)</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-11-06 08:52:55" datetime="2019-11-06T00:52:55.000Z"  itemprop="datePublished">2019-11-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Web安全/">Web安全</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的XSS，需要区分情景对待。今天将学习XSS攻击的原理，已经如何正确地防御它。<br><a id="more"></a></p>
<h1 id="XSS简介"><a href="#XSS简介" class="headerlink" title="XSS简介"></a>XSS简介</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>跨站脚本攻击，英文全称是Cross Site Script，本来缩写是CSS，但是为了和层叠样式表（Cascading Style Sheet，CSS）有所区别，所以在安全领域叫做”XSS”。<br>XSS攻击，通常指黑客通过”HTML注入”篡改了网页，插入了恶意的脚本，从而在用户浏览网页时，控制用户浏览器的一种攻击。在一开始，这种攻击的演示案例是跨域的，所以叫做”跨站脚本”。但是发展到今天，由于Javascript的强大功能已经网站前端应用的复杂化，是否跨域已经不再重要。</p>
<h2 id="XSS类型"><a href="#XSS类型" class="headerlink" title="XSS类型"></a>XSS类型</h2><h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><p>反射型XSS只是简单地把用户输入的数据“反射”给浏览器。也就是说，黑客往往需要诱使用户“点击”一个恶意链接，才能攻击成功。反射型XSS也叫做“非持久性XSS”(Non-persistent XSS)。<br>反射型XSS漏洞特点：恶意代码并没有保存在目标网站，而是通过引诱用户点击一个恶意链接来实施攻击，这些恶意链接主要包含以下特征：</p>
<ol>
<li>恶意脚本附加到url中，只有点击此链接才会引起攻击；</li>
<li>不具备持久性，即只要不通过这个特定url访问，就不会有问题；</li>
<li>一般发生于与用户交互的地方。</li>
</ol>
<h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><p>存储型XSS会把用户输入的数据“存储”在服务器端。这种XSS具有很强的稳定性。<br>比较常见的一个场景就是，黑客写下一篇包含由恶意Javascript代码的博客文章，文章发表后，所以访问该博客文章的用户，都会在他们的浏览器中执行这段恶意的Javascript代码。黑客把恶意脚本保存到服务器端，所以这种XSS攻击就叫做“存储型XSS”。</p>
<h3 id="DOM-Based-XSS"><a href="#DOM-Based-XSS" class="headerlink" title="DOM Based XSS"></a>DOM Based XSS</h3><p>通过修改页面的DOM节点形成的XSS，称之为DOM Based XSS。DOM Based XSS从效果上来说也是反射型XSS。单独划分出来，是因为DOM Based XSS的形成原因比较特别，发现它的安全专家专门提出了这种类型的XSS。出于历史原因，也就把它单独作为一个分类了。看如下代码：</p>
<pre><code>&lt;div id=&quot;t&quot;&gt;&lt;/div&gt;
&lt;input type=&quot;text&quot; id=&quot;text&quot; value=&quot;https://baidu.com&quot;/&gt;
&lt;input type=&quot;button&quot; id=&quot;s&quot; value=&quot;write&quot; onclick=&quot;test()&quot;&gt;
&lt;script&gt;
    function test() {
        var str = document.getElementById(&apos;text&apos;).value;
        document.getElementById(&apos;t).innerHtml=&quot;&lt;a href=&apos;&quot; + str + &quot;&apos;&gt;testLink&lt;/a&gt;&quot;
    }
&lt;/script&gt;
</code></pre><p>点击”write”按钮后，会在当前页面插入一个超链接，点击testLink页面就会跳转到你在输入框里输入的链接，但是如果把一段用户数据当作HTML写入到页面中，就会造成DOM Based XSS。你可以在下面的输入框中进行尝试：</p>
<pre>
    <div id="t"></div>
    <input type="text" id="text" value="https://baidu.com">
    <input type="button" id="s" value="write" onclick="test()">
    <script>
        function test() {
            var str = document.getElementById('text').value;
            document.getElementById('t').innerHTML="<a href='" + str + "'>testLink</a>";
        }
    </script>
</pre>

<p>首先我们在输入框中输入：</p>
<pre><code>https://baidu.com
</code></pre><p>然后点击write按钮，会生成一个testLink链接，点击testLink页面就会跳转到百度。<br>但是如果我们输入一串恶意代码，如：</p>
<pre><code>&apos;&gt;&lt;/a&gt;&lt;img src=&quot;xxx&quot; onerror=alert(/xss/)&gt;&lt;a href=&apos;
</code></pre><p>这样页面会直接执行我们想让它执行的脚本（弹出alert窗）。<br>这里是先闭合了a标签，再插入一个会加载错误的img标签，恶意脚本写在img标签的onerror处理函数里面，当然你也可以尝试其他的方式。</p>
<h1 id="XSS攻击进阶"><a href="#XSS攻击进阶" class="headerlink" title="XSS攻击进阶"></a>XSS攻击进阶</h1><h2 id="初探CSS-Payload"><a href="#初探CSS-Payload" class="headerlink" title="初探CSS Payload"></a>初探CSS Payload</h2><p>XSS攻击成功后，攻击者能够对用户当前浏览器的页面植入恶意脚本，通过恶意脚本，控制用户的浏览器。这些<b>用以完成各种具体功能</b>的<b>恶意脚本</b>，被称为“<b>XSS Payload</b>”。<br>一个最常见的XSS Payload，就是通过读取浏览器的Cookie对象，从而发起“Cookie劫持”攻击。Cookie中一般加密保存了当前用户登录凭证。Cookie如果丢失，往往意味着用户的登录凭证丢失。换句话说，攻击者可以不通过密码而直接登录进用户的账户。<br>Cookie的“HttpOnly”标识可以防止“Cookie劫持”，在后面会讲到。</p>
<h2 id="强大的XSS-Payload"><a href="#强大的XSS-Payload" class="headerlink" title="强大的XSS Payload"></a>强大的XSS Payload</h2><p>“Cookie劫持”并非所有的时候都会有效。有的网站肯会在Set-Cookie时给关键Cookie植入HttpOnly标识；有的网站则肯会把Cookie与客户端IP绑定（相关内容会在“XSS的防御”中介绍），从而使得XSS窃取的Cookie失去意义。<br>尽管如此，在XSS攻击成功后，攻击者仍然由许多方式能够控制用户的浏览器。</p>
<h3 id="构造GET和POST请求"><a href="#构造GET和POST请求" class="headerlink" title="构造GET和POST请求"></a>构造GET和POST请求</h3><p>一个网站的应用，一般只需要接受HTTP协议中的GET或POST请求，即可完成所有操作。对于攻击者来说，仅通过Javascript，就可以让浏览器发起这两种请求。做过Ajax应用的人都知道，使用Javascript模拟浏览器发包并不是一件困难的事情。这在某些隔离环境中会非常有用，比如在“Cookie”失效时。</p>
<h3 id="XSS钓鱼"><a href="#XSS钓鱼" class="headerlink" title="XSS钓鱼"></a>XSS钓鱼</h3><p>XSS并非万能。前面的XSS攻击过过程都是在浏览器中通过Javascript脚本自动进行的，也就是说，缺少“与用户交互”的过程。<br>利用“通过POST表单发消息”攻击，如果提交表单时要求用户输入验证码，那么一般的XSS Payload都会失效；此外，在大多数“修改用户密码”功能中，在提交新密码之前，都会要求用户输入“Old Password”。而这个“Old Password”，对于攻击者来说，往往是不知道的。<br>但是，这并不能限制住XSS攻击。<br>对于验证码，XSSPayload可以通过读取页面内容，将验证码的图片URL发送到远程服务器上来实施——攻击者可以在远程XSS后台接收当前验证码，并将验证码的值返回给当前的XSS Payload，从而绕过验证码。<br>修改密码问题稍微复杂点，为了窃取密码，攻击者可以将XSS与“钓鱼”相结合。<br>实现思路很简单：利用Javascript在当前页面上“画出”一个伪造的登录框，当用户在登录框中输入用户名与密码后，其密码将被发送到黑客的服务器。</p>
<h3 id="识别用户浏览器"><a href="#识别用户浏览器" class="headerlink" title="识别用户浏览器"></a>识别用户浏览器</h3><p>很多时候，攻击者为了获取更大的利益，往往需要准确收集用户的个人信息。比如，如果知道用户使用的浏览器、操作系统，攻击者就有可能实施一次精准的浏览器内存攻击，最终给用户电脑植入一个木马。XSS能够帮助攻击者快速达到收集信息的目的。<br>通过Javascript脚本识别浏览器版本，最直接的莫过于通过XSS读取浏览器的UserAgent对象。</p>
<pre><code>alert(navigator.userAgent);
</code></pre><p><pre><br>    <button onclick="alert(navigator.userAgent)">点击查看你的浏览器与操作系统信息</button><br></pre><br>但是浏览器的userAgent时可以伪造的。攻击者可使用其他方法准确识别用户的浏览器版本。</p>
<h3 id="识别用户安装的软件"><a href="#识别用户安装的软件" class="headerlink" title="识别用户安装的软件"></a>识别用户安装的软件</h3><p>知道了用户使用的浏览器、操作系统后，进一步可以识别用户安装的软件。<br>在IE中，可以通过判断ActiveX控件的classid是否存在，来推测用户是否安装了该软件。这张方法很早就被用户“挂马攻击”——黑客通过判断用户安装的软件，选择对应的浏览器漏洞，最终达到植入木马的的目的。<br>浏览器的扩展和插件也能被XSS Payload扫描出来。比如对于Firefox的插件和扩展，有着不同的检测方法。</p>
<h3 id="获取用户的真实IP地址"><a href="#获取用户的真实IP地址" class="headerlink" title="获取用户的真实IP地址"></a>获取用户的真实IP地址</h3><p>很多时候，用户电脑使用了代理服务器，或者在局域网中隐藏在NAT后面。网站看到的客户端IP地址，是内网的出口IP地址，而并非用户电脑真实的本地IP地址。如何才能知道用户的本地IP地址呢？<br>Javascript本身并没有提供获取本地IP地址的能力。一般来说，XSS攻击需要借助第三方软件来完成，比如，客户端安装了Java环境（JRE），那么XSS就可以通过调用Java Applet的接口获取客户端的本地IP地址。除了Java之外，一些ActiveX控件可能也会提供接口查询本地IP地址，这些功能比较特殊，需要根据具体情况分析。</p>
<h2 id="XSS攻击平台"><a href="#XSS攻击平台" class="headerlink" title="XSS攻击平台"></a>XSS攻击平台</h2><p>XSS Payload如此强大，为了使用方便，由安全研究者将许多功能封装起来，成为XSS攻击平台。这些攻击平台的主要目的是为了演示XSS的危害，以及方便渗透测试使用。下面是几个常见的XSS攻击平台。</p>
<ol>
<li>Attack API：安全研究者pdp所主导的一个项目，它总结出了很多能够直接使用的XSS Payload，归纳为API的方式。</li>
<li>BeEF：曾经是最好的XSS演示平台。不同于Attack API，BeEF所演示的是一个完整的XSS攻击过程。BeEF有一个控制后台，攻击者可以在后台控制前端的一切。每个XSS攻击的用户都将出现在后台，后台控制着可以在控制这些浏览器的行为，并可以通过XSS向这些用户发送命令。</li>
<li>XSS-Proxy：一个轻量级的XSS攻击平台，通过嵌套iframe的方式可以实时地远程控制被XSS攻击的浏览器。</li>
</ol>
<h2 id="终极武器：XSS-Worm"><a href="#终极武器：XSS-Worm" class="headerlink" title="终极武器：XSS Worm"></a>终极武器：XSS Worm</h2><p>Samy蠕虫：MySpace.com过滤了很多危险得HTML标签，只保留了<code>&lt;a&gt;、&lt;img&gt;、&lt;div&gt;</code>等“安全的标签”。所以事件比如“onclick”等也被过滤了。但是MySpace却允许用户控制标签的style属性，通过style，还是有办法构造出XSS的。比如：</p>
<pre><code>&lt;div style=&quot;background:url(&apos;javascript:alert(1)&apos;)&quot;&gt;
</code></pre><p>其次，MySpace同时还过滤了“javascript”、“onreadystatechange”等敏感词，所以Samy用了“拆分法”绕过这些限制。<br>最后，Samy通过Ajax构造的POST请求，完成了在用户的heros列表里添加自己名字的功能：同时复制蠕虫自身进行传播。至此，XSS Worm就完成了。<br>XSS Word是XSS的一种终极利用方式，它的破坏力和影响力是巨大的。但是发起XSS Worm攻击也有一定的条件。<br><b>一般来说，用户之间发生交互行为的页面，如果存在存储型XSS，则比较容易发起XSS Worm攻击。</b><br>发送站内信、用户留言等页面，都是XSS Worm的高发区，需要重点关注。</p>
<h2 id="调试Javascript"><a href="#调试Javascript" class="headerlink" title="调试Javascript"></a>调试Javascript</h2><p>想要写好XSS Payload，需要有很好的Javascript功底，调试Javascript是必不可少的技能。可以使用调试Javascript以及辅助测试的工具，如：Firebug、IE8 Developer Tools、Fiddler、HttpWatch等，这样在编写XSS Payload与分析浏览器安全时，会事半功倍。</p>
<h2 id="XSS构造技巧"><a href="#XSS构造技巧" class="headerlink" title="XSS构造技巧"></a>XSS构造技巧</h2><h3 id="利用字符编码"><a href="#利用字符编码" class="headerlink" title="利用字符编码"></a>利用字符编码</h3><p>“百度收藏”曾经出现过一个这样的XSS漏洞。百度在一个<code>&lt;script&gt;</code>标签中输入了一个遍历，其中转义了双引号：</p>
<pre><code>var redirectUrl=&quot;\&quot;;alert(/XSS/)&quot;;
</code></pre><p>一般来说，这里是没有XSS漏洞的，因为遍历处于双引号之内，系统转移了双引号导致遍历无法“escape”。<br>但是，百度的返回页面是GBK/GB3212编码的，因此“%cl”和“\”这两个字符组合在一起后，会成为一个Unicode字符。在Firefox下会认为这是一个字符，所以构造：</p>
<pre><code>%cl&quot;;alert(/XSS/);
</code></pre><p>“%cl”把专一字符“\”给“吃掉了”，从而绕过了系统的安全检查，成功实施了XSS攻击。</p>
<h3 id="绕过长度限制"><a href="#绕过长度限制" class="headerlink" title="绕过长度限制"></a>绕过长度限制</h3><p>很多时候，产生XSS的地方会有遍历长度限制，这个限制可能是服务器端逻辑造成的，假设下面代码存在一个XSS漏洞：</p>
<pre><code>&lt;input type=&quot;text&quot; value=&quot;$var&quot; /&gt;
</code></pre><p>攻击者可能这样构造XSS：</p>
<pre><code>$var为：&quot;&gt;&lt;script&gt;alert(/xss/)&lt;script&gt;
</code></pre><p>希望达到的输出效果是：</p>
<pre><code>&lt;input type=&quot;text&quot; value=&quot;&quot;&gt;&lt;script&gt;alert(/xss/)&lt;script&gt; /&gt;
</code></pre><p>假设长度限制为20个字节，则这段XSS会被切割为：</p>
<pre><code>$var 输出为： &quot;&gt;&lt;script&gt;alert(/xss
</code></pre><p>但这样并不能完全保证XSS攻击无效。<br>攻击者可以利用事件(Event)来缩短所需要的字节数：</p>
<pre><code>$var 输出为： &quot;onclick=alert(1)//
</code></pre><p>加上空格符，刚好够20个字节，实际输出为：</p>
<pre><code>&lt;input type=&quot;text&quot; value=&quot;&quot; onclick=alert(1)//&quot;/&gt;
</code></pre><p>当用户点击了文本框后，alert(1)将执行。<br>但利用“事件”能够缩短的字节数是有限的。最好的办法是把XSS Payload写到别处，再通过简短的代码加载这段XSS Payload。<br>最常用的一个“藏代码”的地方，就是“location.hash”。而且根据HTTP协议，location.hash的内容不会在HTTP报中发送，所以服务器端的Web日志中并不会记录下location.hash里面的内容，从而也更好地隐藏了黑客真实的意图。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-11-07T02:18:46.111Z" itemprop="dateUpdated">2019-11-07 10:18:46</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://eviler.top">
            <img src="/img/eviler.png" alt="Eviler Zhao">
            Eviler Zhao
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web安全/">Web安全</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS/">XSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://eviler.top/articles/web-security-xss/&title=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&pic=https://eviler.top/img/eviler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://eviler.top/articles/web-security-xss/&title=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&source=跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的X..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://eviler.top/articles/web-security-xss/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&url=https://eviler.top/articles/web-security-xss/&via=https://eviler.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://eviler.top/articles/web-security-xss/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/articles/web-security-browser/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Web安全——浏览器安全</h4>
      </a>
    </div>
  
</nav>



    

















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Eviler Zhao &copy; 2018 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://eviler.top/articles/web-security-xss/&title=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&pic=https://eviler.top/img/eviler.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://eviler.top/articles/web-security-xss/&title=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&source=跨站脚本攻击(XSS)是客户端脚本安全中的头号大敌。因为XSS破环力强大，且产生的场景复杂，难以一次性解决。现在业内达成的共识是：针对各种不同场景产生的X..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://eviler.top/articles/web-security-xss/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Web安全——XSS(跨站脚本攻击)》 — 独孤剑走偏锋&url=https://eviler.top/articles/web-security-xss/&via=https://eviler.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://eviler.top/articles/web-security-xss/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aQW7DMAwEwPz/0+m5aOzsUk6ByKOTIbiOpgeCpPh4xOv5Z+XvHP3V0c7R9y9YGBgYX8t4nq78KO07s/1DKgYGxg0YRxHs/PkIcM47/8L5m4f7GBgYGHEQTAA5EgMDA2OdkX+nLWUxMDAwZkVs+zwrTT9ei2NgYHwhI++6///zR+43MDAwvorxLNd6gE6SvPpUGBgYWzPyANemZe1oRRtwMTAw7sbIm2Ur+8mXZy05DAyMvRl5yz5PBNtDzwY4fu1gYGDcgNGWjnnCt94Zi1pvGBgYt2G0gxf5kER+rPxXXnQNMTAwNmXMkrYZZpZi1mEXAwNjU8bsiFcF4pXm3RseBgbGFoyipbXQIFtv1b35R2NgYNyGkYS/ttO1crUwLF8xMDBuyWiL27bFNktJox/DwMDYgtEWmSsp46wBV9xUYmBgbMpYuTJMhjBml5d5kMXAwMCYNf0/PZbxYh8DA2NrRj5OkYe/ok0Wj31E1wkYGBg3YOTJWR6ah1V18OuHtTgGBsYNGFcVq/mFaJs+vukaYmBgbM1ok7y2uTYb5lgqYjEwMLZgPMuVt9XaUYylUQ8MDIytGW2YuyoFzEvc9qICAwNjV0Z+xFlCOUsih/exGBgYWzOKFnz55tIIRX6xioGBgbHeuI/L5jzRvCDgYmBgbMpoG23FaFd8GXBBwMXAwPhCRtusz/ErYbQY0cDAwNia0Ya8WaCcXXPmzxgYGJsyfgDGPGqYvh+rAgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '君于何处?待君归来~';
            clearTimeout(titleTime);
        } else {
            document.title = '君归矣，善哉！';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
